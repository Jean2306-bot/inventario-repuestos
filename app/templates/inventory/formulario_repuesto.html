{% extends 'base.html' %}
{% block content %}

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-lg rounded-3">
        <div class="card-header bg-gradient bg-primary text-white text-center py-3">
          <h4 class="mb-0">
            <i class="bi bi-box-seam"></i> 
            {{ 'Editar Repuesto' if repuesto else 'Agregar Nuevo Repuesto' }}
          </h4>
        </div>
        <div class="card-body p-4">
          <form method="post" id="repuestoForm" novalidate>
            {{ form.hidden_tag() }}

            <div class="row g-3">
              <div class="col-md-6">
                {{ form.codigo.label(class="form-label fw-semibold") }}
                {{ form.codigo(class="form-control", placeholder="Ej: 10000001", id="codigo") }}
                <div class="invalid-feedback">El código es obligatorio.</div>
              </div>

              <div class="col-md-6">
                {{ form.marca.label(class="form-label fw-semibold") }}
                {{ form.marca(class="form-control", placeholder="Ej: Samsung", id="marca") }}
                <div class="invalid-feedback">La marca es obligatoria.</div>
              </div>

              <div class="col-md-6">
                {{ form.modelo.label(class="form-label fw-semibold") }}
                {{ form.modelo(class="form-control", placeholder="Ej: A22", id="modelo") }}
                <div class="invalid-feedback">El modelo es obligatorio.</div>
              </div>

              <div class="col-md-6">
                {{ form.categorias.label(class="form-label fw-semibold") }}
                {{ form.categorias(class="form-select", id="categorias") }}
                <div class="invalid-feedback">Debe seleccionar una categoría.</div>
              </div>

              <div class="col-md-6">
                {{ form.precio_c.label(class="form-label fw-semibold") }}
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  {{ form.precio_c(class="form-control", placeholder="0", id="precio_c") }}
                </div>
                <div class="invalid-feedback">Ingrese un precio de compra válido.</div>
              </div>

              <div class="col-md-6">
                {{ form.precio_v.label(class="form-label fw-semibold") }}
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  {{ form.precio_v(class="form-control", placeholder="0", id="precio_v") }}
                </div>
                <div class="invalid-feedback">Ingrese un precio de venta válido.</div>
              </div>

              <div class="col-md-6">
                {{ form.cantidad.label(class="form-label fw-semibold") }}
                {{ form.cantidad(class="form-control", type="number", placeholder="0", id="cantidad") }}
                <div class="invalid-feedback">Ingrese una cantidad válida.</div>
              </div>

              <div class="col-md-6">
                {{ form.compatibilidad.label(class="form-label fw-semibold") }}
                {{ form.compatibilidad(class="form-control", placeholder="Ej: A20, A30", id="compatibilidad") }}
                <div class="invalid-feedback">La compatibilidad es obligatoria.</div>
              </div>

              <div class="col-md-6">
                {{ form.fecha_ingreso.label(class="form-label fw-semibold") }}
                {{ form.fecha_ingreso(class="form-control", type="date", id="fecha_ingreso") }}
                <div class="invalid-feedback">La fecha de ingreso es obligatoria.</div>
              </div>
            </div>

            <div class="text-center mt-4">
              {{ form.submit(class="btn btn-success btn-lg px-5 me-2") }}
              <a href="{{ url_for('inventory.lista') }}" class="btn btn-secondary btn-lg px-5">Cancelar</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap icons (si no los tienes en base.html) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<script>
document.getElementById("repuestoForm").addEventListener("submit", function(event) {
  let formValid = true;

  function validateField(id, condition) {
    const field = document.getElementById(id);
    if (condition) {
      field.classList.remove("is-invalid");
      field.classList.add("is-valid");
    } else {
      field.classList.add("is-invalid");
      field.classList.remove("is-valid");
      formValid = false;
    }
  }

  validateField("codigo", document.getElementById("codigo").value.trim() !== "");
  validateField("marca", document.getElementById("marca").value.trim() !== "");
  validateField("modelo", document.getElementById("modelo").value.trim() !== "");
  validateField("precio_c", parseFloat(document.getElementById("precio_c").value) > 0);
  validateField("precio_v", parseFloat(document.getElementById("precio_v").value) > 0);
  validateField("categorias", document.getElementById("categorias").value.trim() !== "");
  validateField("cantidad", parseInt(document.getElementById("cantidad").value) >= 0);
  validateField("compatibilidad", document.getElementById("compatibilidad").value.trim() !== "");
  validateField("fecha_ingreso", document.getElementById("fecha_ingreso").value.trim() !== "");

  if (!formValid) {
    event.preventDefault();
    event.stopPropagation();
  }
});
</script>

{% endblock %}
