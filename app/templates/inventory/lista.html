{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
  <h2 class="text-center mb-4">Lista de Repuestos</h2>

<!-- FORMULARIO DE FILTROS -->
<form method="get" class="row g-3 mb-4 align-items-end">
  <!-- Ordenar -->
  <div class="col-md-3">
    <label for="ordenar" class="form-label">Ordenar por:</label>
    <select name="ordenar" id="ordenar" class="form-select" onchange="this.form.submit()">
      <option value="" {% if not request.args.get('ordenar') %}selected{% endif %}>Seleccione</option>
      <option value="marca" {% if request.args.get('ordenar') == 'marca' %}selected{% endif %}>Marca</option>
      <option value="modelo" {% if request.args.get('ordenar') == 'modelo' %}selected{% endif %}>Modelo</option>
      <option value="precio_c" {% if request.args.get('ordenar') == 'precio_c' %}selected{% endif %}>Precio de compra</option>
      <option value="precio_v" {% if request.args.get('ordenar') == 'precio_v' %}selected{% endif %}>Precio de venta</option>
    </select>
  </div>
  <!-- Buscar -->
  <div class="col-md-3">
    <label for="busqueda" class="form-label">Buscar repuesto:</label>
    <input type="text" name="busqueda" id="busqueda" 
           class="form-control" 
           value="{{ request.args.get('busqueda', '') }}">
  </div>

  <!-- Categoría -->
  <div class="col-md-3">
    <label for="categoria" class="form-label">Filtrar por categoría:</label>
    <select name="categorias" id="categorias" class="form-select" onchange="this.form.submit()">
      <option value="" {% if not request.args.get('categorias') %}selected{% endif %}>Todas</option>
      <option value="bajos" {% if request.args.get('filtro') == 'bajos' %}selected{% endif %}>Stock bajo</option>
      {% for cat in categorias %}
        <option value="{{ cat.nombre }}" {% if request.args.get('categorias') == cat.nombre %}selected{% endif %}>
          {{ cat.nombre }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Botón borrar filtros -->
  <div class="col-md-3 d-flex">
    <a href="{{ url_for('inventory.lista') }}" 
       class="btn btn-outline-danger w-100">
       Borrar filtros
    </a>
  </div>
</form>



  <!-- BOTÓN NUEVO REPUESTO -->
  <div class="mb-3 text-end">
    <a href="{{ url_for('inventory.crear_categorias') }}" class="btn btn-outline-primary">Agregar categoría</a>
    <a href="{{ url_for('inventory.nuevo') }}" class="btn btn-outline-success">Agregar nuevo</a>
  </div>

  <!-- LISTADO EN TABLA -->
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Código</th>
        <th>Marca</th>
        <th>Modelo</th>
        <th>Categoría</th>
        <th>Cantidad</th>
        <th>Precio de compra</th>
        <th>Precio de venta</th>
        <th>Compatibilidad</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for repuesto in repuestos %}
        <tr>
          <td>{{ repuesto.codigo }}</td>
          <td>{{ repuesto.marca }}</td>
          <td>{{ repuesto.modelo }}</td>
          <td>{{ repuesto.categoria.nombre }}</td>
          <td>{{ repuesto.cantidad }}</td>
          <td>${{ repuesto.precio_c }}</td>
          <td>${{ repuesto.precio_v }}</td>
          <td>{{ repuesto.compatibilidad }}</td>
          <td>
            <a href="{{ url_for('inventory.editar', id=repuesto.id) }}" class="btn btn-sm btn-warning">Editar</a>
            <a href="{{ url_for('inventory.eliminar', id=repuesto.id) }}" class="btn btn-sm btn-danger">Eliminar</a>
            <a href="{{ url_for('inventory.agregar_instalacion', id=repuesto.id) }}" class="btn btn-sm btn-info">Seleccionar</a>
            <a href="{{ url_for('inventory.ver', id=repuesto.id) }}" class="btn btn-sm btn-secondary">Ver</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
